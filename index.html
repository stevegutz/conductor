<!DOCTYPE html>
<html>
<head>
<title>Conductor</title>

<style type="text/css">
body {
  vertical-align: middle;

  background-color: #FFEFB7;

  /* change family ?*/
  font-family: Helvetica, Arial, sans-serif;
  font-size: 16px;
  text-align: center;
}

button {
  border: 1px solid transparent;
  border-radius: 4px;
  height: 30px;
  width: 60px;

  background-color: #F8AA96;

  text-align: center;
  font-size: 14px;
}

#btn-div {
  margin: 10px 0 12px 0;
}

div.check {
  display: none;
}

/* Scale check boxes*/
#scale-check-div {
  margin-left: auto;
  margin-right: auto;
  width: 300px;
}

.scale-col {
  width: 150px;
}

#scale-type-div {
 float: left;
}

#scale-pattern-div {
 float: right;
}

.scale-option {
  clear: both;
  float: right;
  margin-right: 6px;
}

.pattern-option {
  clear: both;
  float: left;
  margin-left: 6px;
}

/* TODO Chord checkboxes*/
</style>
</head>

<body>

<header>
    <h2>Conductor</h2>
</header>

<span id="result-span">&nbsp;</span>
<div id="btn-div">
  <span id="btn-label">Give me a&nbsp;</span>
  <button type="button" id="scale-btn" onclick="scale()">
    scale!
  </button>
  <button type="button" id="chord-btn" onclick="chord()">
    chord!
  </button>
</div>

<div class="center check" id="scale-check-div">
  <!-- TODO this stuff would be really nice in a loop  -->
  <div class="scale-col" id="scale-type-div">
    <div class="scale-option">
      <span class="scale-name">major</span>
      <input type="checkbox" name="scale" value="major" checked="true">
    </div>
    <div class="scale-option">
      <span class="scale-name">dorian</span>
      <input type="checkbox" name="scale" value="dorian" checked="true">
    </div>
    <div class="scale-option">
      <span class="scale-name">lydian</span>
      <input type="checkbox" name="scale" value="lydian" checked="true">
    </div>
    <div class="scale-option">
      <span class="scale-name">mixolydian</span>
      <input type="checkbox" name="scale" value="mixolydian" checked="true">
    </div>
    <div class="scale-option">
      <span class="scale-name">minor</span>
      <input type="checkbox" name="scale" value="minor" checked="true">
    </div>
    <div class="scale-option">
      <span class="scale-name">harmonic minor</span>
      <input type="checkbox" name="scale" value="harmonic minor" checked="true">
    </div>
  </div>
  <div class="scale-col" id="scale-pattern-div">
    <div class="pattern-option">
      <input type="checkbox" name="pattern" value="thirds" checked="true">
      <span class="pattern-name">thirds</span>
    </div>
    <div class="pattern-option">
      <input type="checkbox" name="pattern" value="triads" checked="true">
      <span class="pattern-name">triads</span>
    </div>
    <div class="pattern-option">
      <input type="checkbox" name="pattern" value="arpeggios" checked="true">
      <span class="pattern-name">arpeggios</span>
    </div>
    <div class="pattern-option">
      <input type="checkbox" name="pattern" value="fourths" checked="true">
      <span class="pattern-name">fourths</span>
    </div>
    <div class="pattern-option">
      <input type="checkbox" name="pattern" value="fifths" checked="true">
      <span class="pattern-name">fifths</span>
    </div>
    <div class="pattern-option">
      <input type="checkbox" name="pattern" value="sixths" checked="true">
      <span class="pattern-name">sixths</span>
    </div>
    <div class="pattern-option">
      <input type="checkbox" name="pattern" value="sevenths" checked="true">
      <span class="pattern-name">sevenths</span>
    </div>
    <div class="pattern-option">
      <input type="checkbox" name="pattern" value="octaves" checked="true">
      <span class="pattern-name">octaves</span>
    </div>
    <div class="pattern-option">
      <input type="checkbox" name="pattern" value="ninths" checked="true">
      <span class="pattern-name">ninths</span>
    </div>
  </div>
</div>

<div class="check" id="chord-check-div">
  <input type="checkbox" name="chord" value="maj7" checked="true">maj7<br>
  <input type="checkbox" name="chord" value="7">7<br>
  <input type="checkbox" name="chord" value="&ndash;7">&ndash;7<br>
  <input type="checkbox" name="chord" value="&ndash;7&#9837;5">&ndash;7&#9837;5<br>
</div>

<!-- TODO Checkboxes: custom; Save in cookie on click -->

<script type="text/javascript">
  var keys = [ 
    "C", "C&#9839;", "D", "E&#9837;", 
    "E", "F", "F&#9839;", "G", 
    "A&#9837;", "A", "B&#9837;", "B",
  ];

  // In C (modes of the major scale)
  var majorPos = [ 2, 3, 5, 7, 8, 12 ];
  var minorPos = [ 3, 5, 8, 10, 12 ];
  var scalePositions = {
    "major" : majorPos,
    "dorian" : minorPos,
    "lydian" : majorPos,
    "mixolydian" : majorPos,
    "minor" : minorPos,
    "harmonic minor" : [ 3, 5, 7, 10, 12 ],
    // "melodic minor" : [],
    // "altered" : [],
    // "whole-tone" : [],
    // "diminished" : [],
  };

  function scale() {
    showScaleBoxes();
    var scales = getCheckedBoxes("scale");
    if (scales.length == 0) {
      return;
    }

    var res = "";

    var keyIndex = randomIndex(keys);
    res += keys[keyIndex] + " ";

    var scale = randomElement(scales);
    res += scale;

    var positions = scalePositions[scale];
    if (typeof positions !== "undefined") {
      var position =  randomElement(positions) + keyIndex;
      if (position > 12)  {
        position -= 12;
      }
      res += " in " + appendSuffix(position) + " position";
    }

    var patterns = getCheckedBoxes("pattern");
    if (patterns.length > 0) {
      res += " played in " + randomElement(patterns);
    }

    // TODO Different spans for each element
    // TODO format results
    document.getElementById("result-span").innerHTML = res;
  }

  function chord() {
    showChordBoxes();
    var chords = getCheckedBoxes("chord");
    if (chords.length == 0) {
      return;
    }
    document.getElementById("result-span").innerHTML =
      randomElement(keys) + randomElement(chords)
  }

  function randomElement(array) {
    return  array[randomIndex(array)]
  }

  function randomIndex(array) {
    return  Math.floor(Math.random() * array.length)
  }

  function getCheckedBoxes(name) {
    var boxes = document.getElementsByName(name);
    var checked = [];
    for (var i = 0; i < boxes.length; i++) {
      var b = boxes[i];
      if (b.checked) {
        checked.push(b.value);
      }
    }
    return checked;
  }

  // For n in 0..20
  function appendSuffix(n) {
    switch(n) {
    case 1: return n + "st";
    case 2: return n + "nd";
    case 3: return  n +"rd";
    default: return n + "th";
    }
  }

  function showScaleBoxes() {
    document.getElementById("chord-check-div").style.display = "none";
    document.getElementById("scale-check-div").style.display = "table";
  }

  function showChordBoxes() {
    document.getElementById("scale-check-div").style.display = "none";
    document.getElementById("chord-check-div").style.display = "inline";
  }
</script>
</body>
</html>
