<!DOCTYPE html>
<html>
<head>
<title>Conductor</title>

<style type="text/css">
body {
  vertical-align: middle;

  background-color: #FFEFB7;

  /* change family ?*/
  font-family: Helvetica, Arial, sans-serif;
  font-size: 16px;
  text-align: center;
}

button {
  border: 1px solid transparent;
  border-radius: 4px;
  height: 30px;
  width: 60px;

  background-color: #F8AA96;

  text-align: center;
  font-size: 14px;
}

div.check {
  display: none;
}

div.scale-input {
  display: table-cell;
}

#btn-div {
  margin: 10px 0 12px 0;
}

#scale-check-div {
  margin-left: auto;
  margin-right: auto;
  width: 40%;
}
</style>
</head>

<body>
<span id="result-span"></span>
<!-- Arpeggios? -->
<div id="btn-div">
  <!-- Margin better? -->
  <span id="btn-label">Give me a&nbsp;</span>
  <button type="button" id="scale-btn" onclick="scale()">
    scale!
  </button>
  <button type="button" id="chord-btn" onclick="chord()">
    chord!
  </button>
</div>

<div class="center check" id="scale-check-div">
  <div style="display: table-row;">
    <div class="scale-input">
      <input type="checkbox" name="scale" value="major">major<br>
      <input type="checkbox" name="scale" value="dorian">dorian<br>
      <input type="checkbox" name="scale" value="lydian">lydian<br>
      <input type="checkbox" name="scale" value="mixolydian">mixolydian<br>
      <input type="checkbox" name="scale" value="minor">minor<br>
      <input type="checkbox" name="scale" value="harmonic minor">harmonic minor
    </div>
    <div class="scale-input">
      <input type="checkbox" name="pattern" value="thirds">thirds<br>
      <input type="checkbox" name="pattern" value="triads">triads<br>
      <input type="checkbox" name="pattern" value="arpeggios">arpeggios<br>
      <input type="checkbox" name="pattern" value="fourths">fourths<br>
      <input type="checkbox" name="pattern" value="fourths">fifths<br>
      <input type="checkbox" name="pattern" value="fourths">sixths<br>
      <input type="checkbox" name="pattern" value="fourths">sevenths<br>
      <input type="checkbox" name="pattern" value="fourths">octaves<br>
      <input type="checkbox" name="pattern" value="fourths">ninths
    </div>
  </div>
</div>

<div class="check" id="chord-check-div">
  <form action="">
    <input type="checkbox" name="chord" value="maj7">maj7<br>
    <input type="checkbox" name="chord" value="7">7<br>
    <input type="checkbox" name="chord" value="&ndash;7">&ndash;7<br>
    <input type="checkbox" name="chord" value="&ndash;7&#9837;5">&ndash;7&#9837;5<br>
  </form>
</div>


<!-- TODO Checkboxes: custom; Save in cookie on click -->
<!-- TODO show checkboxes on click -->

<script type="text/javascript">
  var keys = [ 
    "C", "C&#9839;", "D", "E&#9837;", 
    "E", "F", "F&#9839;", "G", 
    "A&#9837;", "A", "B&#9837;", "B",
  ];

  // In C (modes of the major scale)
  var majorPos = [ 2, 3, 5, 7, 8, 12 ];
  var minorPos = [ 3, 5, 8, 10, 12 ];
  var scalePositions = {
    "major" : majorPos,
    "dorian" : minorPos,
    "lydian" : majorPos,
    "mixolydian" : majorPos,
    "minor" : minorPos,
    "harmonic minor" : [ 3, 5, 7, 10, 12 ],
    // "melodic minor" : [],
    // "altered" : [],
    // "whole-tone" : [],
    // "diminished" : [],
  };

  function scale() {
    showScaleBoxes();
    var scales = getCheckedBoxes("scale");
    if (scales.length == 0) {
      return;
    }

    var res = "";

    var keyIndex = randomIndex(keys);
    res += keys[keyIndex] + " ";

    var scale = randomElement(scales);
    res += scale;

    var positions = scalePositions[scale];
    if (typeof positions !== "undefined") {
      var position =  randomElement(positions) + keyIndex;
      if (position > 12)  {
        position -= 12;
      }
      res += " in " + appendSuffix(position) + " position";
    }

    var patterns = getCheckedBoxes("pattern");
    if (patterns.length > 0) {
      res += " played in " + randomElement(patterns);
    }

    // TODO Different spans for each element
    // TODO format results
    document.getElementById("result-span").innerHTML = res;
  }

  function chord() {
    showChordBoxes();
    var chords = getCheckedBoxes("chord");
    if (chords.length == 0) {
      return;
    }
    document.getElementById("result-span").innerHTML =
      randomElement(keys) + randomElement(chords)
  }

  function randomElement(array) {
    return  array[randomIndex(array)]
  }

  function randomIndex(array) {
    return  Math.floor(Math.random() * array.length)
  }

  function getCheckedBoxes(name) {
    var boxes = document.getElementsByName(name);
    var checked = [];
    for (var i = 0; i < boxes.length; i++) {
      var b = boxes[i];
      if (b.checked) {
        checked.push(b.value);
      }
    }
    return checked;
  }

  // For n in 0..20
  function appendSuffix(n) {
    switch(n) {
    case 1: return n + "st";
    case 2: return n + "nd";
    case 3: return  n +"rd";
    default: return n + "th";
    }
  }

  function showScaleBoxes() {
    document.getElementById("chord-check-div").style.display = "none";
    document.getElementById("scale-check-div").style.display = "table";
  }

  function showChordBoxes() {
    document.getElementById("scale-check-div").style.display = "none";
    document.getElementById("chord-check-div").style.display = "inline";
  }
</script>
</body>
</html>
